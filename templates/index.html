<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>INTERPLAST COMPANY LIMITED - CONTAINER LOADING SYSTEM</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background: linear-gradient(to bottom, #87CEFA, #00BFFF);
        }
        .header {
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: rgba(0,0,128,0.7);
            color: white;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
            position: relative;
        }
        .logo {
            position: absolute;
            left: 20px;
            height: 45px;
            width: auto;
        }
        .header-text {
            text-align: center;
        }
        .header-text h1 { margin: 0; font-size: 2.2em; }
        .header-text h2 { margin: 0; font-size: 1.5em; }

        .form-container {
            width: 100%;
            max-width: none;
            margin: 30px auto;
            background: rgba(255,255,255,0.95);
            padding: 35px;
            border-radius: 15px;
            box-shadow: 0 6px 12px rgba(0,0,0,0.25);
            box-sizing: border-box;
        }

        h3 { color: #00008B; margin-top: 25px; }

        .container-options {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
        }

        .container-item {
            display: flex;
            align-items: center;
            background: rgba(240,248,255,0.8);
            padding: 8px 12px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.15);
        }

        .container-item input[type="number"] {
            width: 70px;
            margin-left: 8px;
            padding: 4px;
            text-align: center;
        }

        select, input[type="text"], input[type="number"], input[type="file"], input[type="submit"], button {
            padding: 8px;
            margin: 5px 0;
            border-radius: 5px;
            border: 1px solid #ccc;
            font-size: 1em;
        }
        input[type="submit"], button {
            background-color: #1E90FF;
            color: white;
            cursor: pointer;
            border: none;
            font-weight: bold;
        }
        input[type="submit"]:hover, button:hover { background-color: #104E8B; }

        table {
            border-collapse: collapse;
            width: 100%;
            background-color: white;
            font-size: 1em;
            margin-top: 10px;
            table-layout: auto;
        }
        th, td {
            border: 1px solid #999;
            padding: 12px 10px;
            text-align: center;
            word-wrap: break-word;
        }
        th { background-color: #4682B4; color: white; }
        tr:hover { background-color: #f1f1f1; }

        .footer { margin-top: 40px; font-size: 0.9em; color: gray; text-align: center; }
    </style>
</head>
<body>

<div class="header">
    <img src="{{ url_for('static', filename='IPLog.jpg') }}" alt="Logo" class="logo">
    <div class="header-text">
        <h1>INTERPLAST COMPANY LIMITED</h1>
        <h2>CONTAINER LOADING SYSTEM</h2>
    </div>
</div>

<div class="form-container">
<form action="/run" method="post" enctype="multipart/form-data">
    <h3>Step 1: Select Containers</h3>
    <div class="container-options">
        {% for c in containers %}
        <div class="container-item">
            <label>
                <input type="checkbox" name="container" value="{{ c['id'] }}"
                {% if c['id'] in selected_container_ids %}checked{% endif %}>
                {{ c['id'] }} - {{ c['type'] }} ({{ c['length'] }}x{{ c['width'] }}x{{ c['height'] }})
            </label>
            <label>&nbsp;Qty:
                <input type="number" name="container_qty_{{ c['id'] }}" min="0" value="{{ container_quantities.get(c['id'], 1) }}" style="width:60px;">
            </label>
        </div>
        {% endfor %}
    </div>

    <h3>Step 2: Enter Pallets Manually</h3>
    <table id="pallet-table">
        <tr>
            <th>Pallet ID</th><th>Length</th><th>Width</th><th>Height</th><th>Quantity</th><th>Action</th>
        </tr>
        {% if pallets_data %}
            {% for p in pallets_data %}
            <tr>
                <td><input type="text" name="pallet_id[]" value="{{ p['pid'] }}"></td>
                <td><input type="number" name="length[]" step="0.01" value="{{ p['l'] }}"></td>
                <td><input type="number" name="width[]" step="0.01" value="{{ p['w'] }}"></td>
                <td><input type="number" name="height[]" step="0.01" value="{{ p['h'] }}"></td>
                <td><input type="number" name="quantity[]" value="{{ p['qty'] }}"></td>
                <td><button type="button" onclick="removeRow(this)">Remove</button></td>
            </tr>
            {% endfor %}
        {% else %}
        <tr>
            <td><input type="text" name="pallet_id[]"></td>
            <td><input type="number" name="length[]" step="0.01"></td>
            <td><input type="number" name="width[]" step="0.01"></td>
            <td><input type="number" name="height[]" step="0.01"></td>
            <td><input type="number" name="quantity[]"></td>
            <td><button type="button" onclick="removeRow(this)">Remove</button></td>
        </tr>
        {% endif %}
    </table>
    <button type="button" onclick="addRow()">Add Row</button>

    <h3>Step 3: Import from Excel</h3>
    <input type="file" id="excelFile" accept=".xlsx,.xls,.xlsm">
    <button type="button" onclick="importExcel()">Import Excel</button>

    <br><br>
    <input type="submit" value="Run Packing Logic">
    <a href="/clear"><button type="button">Clear All</button></a>
</form>
</div>

<div class="footer">Developed by Noorul Haq</div>

<script>
    function addRow() {
        const table = document.getElementById("pallet-table");
        const row = table.insertRow(-1);
        row.innerHTML = `
            <td><input type="text" name="pallet_id[]"></td>
            <td><input type="number" name="length[]" step="0.01"></td>
            <td><input type="number" name="width[]" step="0.01"></td>
            <td><input type="number" name="height[]" step="0.01"></td>
            <td><input type="number" name="quantity[]"></td>
            <td><button type="button" onclick="removeRow(this)">Remove</button></td>
        `;
    }

    function removeRow(btn) {
        const row = btn.parentNode.parentNode;
        const table = document.getElementById("pallet-table");
        if (table.rows.length > 2) {
            row.parentNode.removeChild(row);
        } else {
            alert("At least one row is required.");
        }
    }

    function importExcel() {
        const file = document.getElementById('excelFile').files[0];
        if(!file) { alert("Please select a file"); return; }
        const reader = new FileReader();
        reader.onload = function(e) {
            const data = new Uint8Array(e.target.result);
            const workbook = XLSX.read(data, {type:'array'});
            const sheet = workbook.Sheets[workbook.SheetNames[0]];
            const json = XLSX.utils.sheet_to_json(sheet, {header:1});
            const table = document.getElementById("pallet-table");
            for(let i=1; i<json.length; i++){
                if(json[i].length === 0) continue;
                const row = table.insertRow(-1);
                row.innerHTML = `
                    <td><input type="text" name="pallet_id[]" value="${json[i][0] || ''}"></td>
                    <td><input type="number" name="length[]" step="0.01" value="${json[i][1] || ''}"></td>
                    <td><input type="number" name="width[]" step="0.01" value="${json[i][2] || ''}"></td>
                    <td><input type="number" name="height[]" step="0.01" value="${json[i][3] || ''}"></td>
                    <td><input type="number" name="quantity[]" value="${json[i][4] || ''}"></td>
                    <td><button type="button" onclick="removeRow(this)">Remove</button></td>
                `;
            }
            alert("Excel records imported!");
        };
        reader.readAsArrayBuffer(file);
    }
</script>

</body>
</html>
